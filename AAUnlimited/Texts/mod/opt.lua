--disabled@INFO Optimizations

-- The game uses a lot of atomics, even in hot loops, while being
-- single threaded. On CPUs lacking thread cache tags, removing
-- the locks gets rid of the stall otherwise introduced by the lock prefix.

local _M = {}


local addrs = [[

00401311 00401335 00401B6A 00401B92 00401DFC 00401E61 00401EAD 0040208A
004020AE 004021B6 004021D7 004021F7 004022CB 004022EF 0040239D 00402A7A
00402AF9 004036D6 0040370C 0040374A 004037BA 00403AEA 00403B06 00403B22
00403B42 00403B9C 00403C98 00403CB4 00403CD0 00403CFA 00404B40 00404B61
00404B85 00404CAD 00404F81 00404FA1 00404FC5 004050FD 004067C7 0040696E
0040698F 004069B4 004069DC 00406DFF 00406ED0 00407353 004074FE 0040751F
00407544 0040756C 0040798F 00407A60 00407EE3 00408983 004089BF 00409329
0040934D 00409CAF 00409CD0 00409CF1 00409D19 00409E3E 00409E60 00409E82
0040A869 0040A97D 0040A9D3 0040AA26 0040AA9D 0040AAC4 0040ACDE 0040AD06
0040AD2E 0040AD52 0040AE4F 0040AE7A 0040E2F3 0040E314 0040E33C 0040E62B
0040E758 0040E838 0040E9A1 0040EA1A 00410110 0041042C 00410450 00410478
00410630 00410779 004107D3 00410DC1 0041137B 004113C8 00411498 004114C0
0041174A 00411B4F 00411CE7 00411F1F 00411FFD 00412035 0041205A 0041237F
004123C2 0041255F 0041263D 00412675 0041269A 00412CB6 00412CE1 00414556
004145C1 004175E9 00418C32 00418C7A 0041916F 00419254 00419D11 0041A04C
0041A06B 0041A08A 0041A0A9 0041A0C7 0041AA74 0041AA9C 0041BD2B 0041BD56
0041C2F3 0041D217 0041D256 0041D2BF 0041D2E3 0041D660 0042301E 00423046
00423C9B 00424183 00424B89 00424BCD 00424C56 00424C7E 00429586 0042967C
00429775 00429927 00429A72 00429C63 00429DA7 00429F9D 0042A0E4 0042A188
0042A1B0 0042A48A 0042A4B2 0042A5F6 0042A61D 0042AB9F 0042ABCF 0042C0AB
0042C190 0042C251 0042C4E2 0042C92F 0042CA16 0042DF4D 0042DF78 0042E049
0042E12D 0042E155 0042E179 0042E980 0042EB53 0042EB7A 0042F20B 0042F443
0042F468 0042F53B 0042F560 0042F585 0042F5AD 0042F7C1 0042F7E6 0042F8BB
0042F8E0 0042F905 0042F92D 0042FB41 0042FB66 0042FC3B 0042FC60 0042FC85
0042FCAD 0043024B 00430A87 004325F1 0043266F 004359D0 004359F8 00435B10
00435B38 00437C7F 00437C9E 00437CBD 00437CDC 00437CFB 00437D1A 00437D39
00437D58 00437D77 00437D96 00437DB5 00437DD4 00437DF3 00437E12 00437E31
00437E4F 00438127 00438420 00438466 004384B6 0043853B 00438636 0043867B
004386B0 004386D8 0043DEB9 0044A00B 0044A033 0044A158 0044A180 0044AA69
0044AA94 0044AC3E 0044AC69 0044C27F 0044C2A1 0044F8D0 0044F8F5 0044FA29
0044FA51 00452769 00452A0E 00452A3D 00452CB6 00452E8D 00452FDD 004538D2
004538FA 00453928 00453950 00453C4C 00453C74 00453CA2 00453CCA 00453F00
00453F25 00453F4D 00453F93 00453FEE 0045404E 00454073 00454098 004540BD
004540E5 0045421B 004543B7 0045444D 00454472 00454497 004544BC 004544FE
0045455E 00454583 004545A8 004545CD 004545F2 0045461A 0045476B 004547AD
0045480D 00454832 00454857 0045487C 004548A1 004548C9 00454A10 00454A35
00454A5D 00454AA3 00454B3A 00454B9A 00454BBF 00454BE4 00454C09 00454C2E
00454C56 00454E6A 00454F75 00454FD5 00454FFA 0045501F 00455044 0045506C
004550B1 004550D6 004550FE 00455240 00455265 0045528D 004552D3 0045536C
004553CC 004553F1 00455416 0045543B 00455463 00459AA9 0045D53C 0045DF8C
0045DFB4 0045DFEB 0045E147 0045E16C 0045E447 0045E46F 0045E497 0045E4BF
0045E6B9 0045E6E1 0045EEAB 0045EED3 0045EF0A 0045F1CB 0045F1F3 0045F22A
0045F43B 0045F463 0045F49A 0045F83B 0045F863 0045F88B 0045F8B3 0045F977
0045F99F 0045F9C7 00460C56 0046E440 00471C2D 00471D3F 00471DA5 00471DCD
00471F1D 0047202F 0047208E 004720B6 00475545 0047556D 00475738 00475760
0047BCED 0047BD18 0047BDFE 0047BE29 0047BF0F 0047BF3A 0047C020 0047C04B
0047C131 0047C15C 0047C242 0047C26D 0047C353 0047C37E 0047C464 0047C48F
0047C575 0047C5A0 0047C686 0047C6B1 0047C834 0047C85C 0047CDEC 0047CE14
0047D2BB 0047D2E3 0047D5CA 0047D5F2 0047D71A 0047D742 0047DAD6 0047DAFE
0047DC04 0047DC2C 0047DDC7 0047DDEF 0047E27D 0047E2A5 00483597 004835C2
004837B2 004837DD 004872E8 004873FC 0049422B 00494253 004944F3 0049451B
0049DA94 004A6837 004A6862 004A86FD 004A8728 004A8900 004A892B 004A8A32
004A8A5D 004A8C0F 004A8C37 004A9167 004A91D7 004A91FC 004A92FA 004A9360
004A9385 004A93AA 004A9446 004A946B 004A9557 004A95FF 004A96AD 004A96CE
004A96F3 004A9742 004A9777 004AC6E9 004AC96C 004AC993 004AD6E1 004AD768
004ADCB6 004ADD18 004ADDE5 004ADE6F 004ADF63 004ADF88 004ADFAD 004AE07F
004AE0A4 004AE0C9 004AE16A 004AE35F 004B00C8 004B0155 004B017D 004B01A5
004B0328 004B0350 004B038B 004B03D7 004B03F7 004B0417 004B07B9 004B1B8B
004B1BE3 004B1C3B 004B1DBC 004B1DDB 004B1DFA 004B1EE9 004B221C 004B223B
004B2259 004B2DBC 004B57D8 004B5800 004B5828 004B596A 004B5992 004B5A00
004B5C02 004B5E9A 004B5EC2 004B5EEA 004B5F32 004B5F5A 004B5F85 004B638F
004B63B7 004B6531 004B7845 004B789D 004B78F5 004B794D 004B7B89 004B7DCC
004B7DEB 004B7E0A 004B7E28 004B8732 004B878C 004B8A81 004B8AC9 004B8B44
004BCB07 004BCE16 004C11F4 004C1AB5 004C1B14 004C1B6D 004C1BC6 004C1C1F
004C34A7 004C7682 004C81BA 004C8F4F 004C9E71 004C9EFD 004C9F25 004C9F4D
004CA013 004CA0AE 004CA38A 004CA3DE 004D111D 004DB974 004DB99F 004DCFA2
004E0656 004E0699 004E0714 004E0738 004E0763 004E1810 004E2694 004E2700
004E493D 004E4C27 004E5A85 004E5EDF 004E5F21 004E5F63 004E78DF 004E7945
004E79CB 004E7A06 004E7B98 004E7C94 004E7CB8 004E7F9E 004E7FC6 004E82AF
004E834C 004E8416 004E851F 004E862F 004E874C 004E92F1 004E9552 004E98EE
004E994B 004EA1A5 004EA1C4 004EA5BC 004EA863 004EAFF7 004EBE49 004ECF0C
004ECF34 004EDBFD 004EE59A 004EE65E 004EF465 004EF8E4 004EF90C 004EFBD8
004EFC55 004EFD41 004EFD68 004EFDA1 004EFDC4 004F0014 004F090A 004F0956
004F10E8 004F11B3 004F19C2 004F1A78 004F1AC5 004F21D9 004F2313 004F233E
004F3093 004F312B 004F317B 004F31AF 004F438F 004F43BA 004F5449 004F5485
004F55A9 004F5627 004F56C1 004F571E 004F57A7 004F5F3E 004F5F96 004F5FEE
004F6046 004F62F5 004F6314 004F6333 004F6352 004F64F6 004F6517 004F6538
004F655C 004F898E 004F89AF 004F89D0 004F89F4 004F8AF6 004F8B17 004F8E83
004F8EA4 004F8EC5 004F8EE9 004F933B 004F935C 004F937D 004F93A1 004F94A7
004F94C8 004F9866 004F9887 004F98A8 004F98CC 004F99CE 004F99EF 004FFB68
00500169 005003BF 005003F5 005005DF 00500605 005009D5 00500AAB 00500AD3
00500B99 00500BC1 00500C8C 00500CB4 00500E9E 00500EC9 00500FE8 00501008
0050113F 0050117C 005011D8 0050127E 005012A6 0050134F 00501377 005013AE
005013D6 005013FE 0050146C 00501497 0050176B 0050178F 005017B7 005018C1
005018E9 00501D2D 00501D51 00501FA4 00502036 0050205B 00502080 005020A5
005020FF 00502136 00502214 005022C9 00502452 00502475 00502554 00502603
00502735 00502BDA 00502CA4 0050546F 00505A6B 00505A90 00505AB8 00505BEC
00505C11 00505C39 00505E44 00505E6C 00505EB8 00505EE0 00506276 00506796
005079D5 00508646 00508671 0050881C 00508949 00508974 00508B5E 00508B89
00508C37 00508C62 00508D10 00508D3B 0050994A 00509975 00509AE7 0050A091
0050A0B7 0050A15B 0050A17F 0050B0F4 0050B11F 0050B475 0050B49D 0050B71E
0050B746 0050E03A 0050E13B 0050E166 0050E266 0050E291 0050E3D1 0050E3FC
0050E508 0050E533 0050F193 0050F1F2 0050F251 0050F2B0 00510CCA 00510D29
00511D15 00511D40 00511EF4 00512021 0051204C 00512188 005121B3 0051233C
00512362 00512426 0051244C 005124F1 00512515 00512781 005127A9 00512892
00512BF9 00512C21 00512C76 00512E78 00512E9C 00512EC4 00512EEF 005138A1
005138CC 005139B7 005139E2 00513BBC 00513D29 00513D51 00513E3A 00514153
0051417B 005141D4 005143EB 0051440F 00514437 00514462 00514CE5 00514D0D
00514EBE 00514EE6 00515426 0051544E 005157BF 005157E7 00515923 0051594B
0051632B 0051634C 00516370 00516414 00516439 00516461 0051693F 00516A40
00516A6B 00516BA5 00516BD0 00516D08 00516D33 00516E2F 00516E5A 00525EEB
005261C1 005262E9 005263C9 00526464 0052654F 00526762 00526793 00526A5B
00526D38 00526DD8 00526E45 00526F35 00526F5D 00527030 00527058 0052714C
00527174 005272CE 005272F6 0052735F 00527672 00527773 00527C54 00528015
005280A2 0052812F 005281BC 0052824B 0052844B 005284D6 00528561 005285EC
0052867F 005286D1 005286EF 00528E44 00528E6F 00529027 0052904F 0052910A
00529132 0052926F 00529297 0052939D 00529457 00529503 0052952B 00529663
00529838 00529863 0052991E 00529949 0052A455 0052A498 0052A66C 0052A694
0052A6BC 0052A6E7 0052B0E1 0052B23B 0052B2E2 0052B3C4 0052B93B 0052B9E5
0052BAD6 0052BAFE 0052BE60 0052C25F 0052C31A 0052C36C 0052C394 0052C3C2
0052C42B 0052C846 0052C871 0052D319 0052D33E 0052D366 0052D52A 0052D54F
0052D577 0052D697 0052D6D4 0052DF37 0052DF5C 0052DF84 0052E176 0052E29F
0052E310 0052E3EB 0052E50E 0052E79D 0052E96B 0052E996 0052F8A8 0052FBD2
00530245 00530512 005307BE 00530A9B 00530BBF 00530CEB 00530E0B 00530F3C
005314FA 00532339 005323E2 005324D6 005325A3 00532698 00532768 00532861
0053290D 00532A19 00532BAB 00532C84 00532E78 00532F38 00532FF8 005330B8
00533178 00533238 005332F8 005333B8 00533478 00533538 005335F8 00533EAC
00533F16 00533F41 00533F6F 00533FE4 0053400F 0053403D 0053420B 00534233
005342AE 005342D6 00534AA7 00534C24 00534C7E 00534CD6 00534D2E 00534D86
00534DDE 00534E36 00534E8E 00534EE6 00534F3E 00534F96 00534FEE 00535046
0053509E 005350F6 005352A6 005352D1 00535FCE 00536056 00536A93 00536AB8
00536AE0 00536C13 00536C38 00536C60 00536E1D 00536E48 00536E76 00536FA0
00536FC5 00536FED 0053726D 00537295 005372BD 00538DEA 00538E12 00539CC3
0053B4D8 0053B52F 0053B583 0053B5D7 0053B62B 0053B6E5 0053C325 0053C378
0053C3CB 0053C41E 0053C471 0053C4C4 0053C517 0053C56A 0053C5B0 00540EE4
00540F0C 00540F34 00540F5F 005411A2 005411C7 00541293 00541360 00541385
005413AA 005413D2 005418CB 005418F3 005419D5 005419FD 00545A9B 00545AE2
00545B29 00545B70 00545BB7 00545BFE 00545C45 00545C8C 00545CD3 00545D13
00547E60 00547E85 00547EAA 00547ED2 005480C6 005480EB 00548110 00548138
00548EBC 00549102 00549127 0054914C 00549174 005492B0 005492D5 005492FA
00549322 0054A223 0054A244 0054A265 0054A289 0054A334 0054A355 0054A376
0054A39E 0055012D 00550152 00550177 0055019F 0055038D 005503B2 005503D7
005503FF 00550691 00550D11 00550D39 00550D61 00550D8C 00550EEC 00550F11
00550F39 00550F61 00551124 00551145 00551166 0055118E 0055173D 00551762
00551787 005517AF 0055227C 005522A7 00552440 00552461 00552BE7 00552D5A
00557A1A 00557A3E 0055CE03 0055CE50 0055CEB9 0055CF06 0055D00D 0055D040
0055D065 0055D08D 0055D45B 0055D7D6 0055D7FE 0055D852 0055D8C6 0055D8EE
005600C1 00561088 005610AA 005610CC 005648F0 005649C9 00564A28 00564A4D
00564A72 00564A9A 005650C8 005651C9 00565285 005652AD 005652D8 00566CFB
0056E80F 0056E82F 0056E850 0056E88C 0056E8CA 0056F984 0056F9A9 0056F9D1
0056F9FB 0056FA20 0056FA48 005785AA 0057886C 00578A21 00578BD6 00578D1F
00578E9D 00585A8C 00585ACE 00585B10 005876D9 0058771E 00587763 005877A8
005877ED 00587832 0058787A 005878C2 0058790A 00587952 0058799A 005879E2
00587A2A 00587A72 00587ABA 00587B03 00587B4C 00587B94 00587BDA 00588CEF
00588D1C 0059052F 00590571 005905B3 005905FB 00590643 0059068B 005906D3
0059071B 00590763 00596168 00596196 0059626D 0059629B 0059638D 00596413
0059643E 0059646C 0059666C 00596697 005966C5 00596D85 00596DDD 00596E51
00596EA8 00596EF0 00596F10 00597159 00597179 0059726A 005972C2 00597305
00597325 005973AB 00597405 00597771 00597828 005978DD 00597A5E 00597ADE
00597C72 00597DC6 00597F1E 00597F5F 005980A5 005980D0 00598102 00598616
00598716 0059897E 00599C30 00599DE7 00599E0B 00599E5B 00599F61 0059C7F8
0059CBB7 0059DB6B 0059DB9E 0059DBE1 0059DC41 0059DE43 0059E08C 0059E38E
0059E3BD 0059E7EE 0059E8E1 0059E959 0059E9C6 0059E9FB 0059EA2F 0059EBE9
0059EC67 0059FED1 0059FF16 0059FF80 0059FFA4 005A005C 005A0080 005A00FF
005A0120 005A017A 005A019B 005A02D4 005A0319 005A0383 005A03A7 005A0460
005A0484 005A04CD 005A04F2 005A089E 005A1B54 005A5C3C 005A84BE 005A8584
005A86E0 005AA20B 005AD82D 005AD887 005AD908 005ADA8C 005ADAB4 005AE510
005AE534 005AE55F 005AE652 005AE676 005AE6A1 005AE794 005AE7B8 005AE7E3
005AE8D6 005AE8FA 005AE925 005AF2A7 005B0E52 005B273C 005B343C 005B3464
005B4676 005B469E 005B6F8B 005B7021 005B70CC 005B70F4 005B77E9 005B7811
005B7BB0 005B97AF 005B9820 005BEC27 005BEC94 005BED57 005BEDC1 005C260C
005C3C7E 005C3CCE 005C3DEF 005C53F2 005C55DF 005C5603 005C562B 005C564E
005C5757 005C577B 005C57A3 005C57C6 005C58A6 005C58CE 005C58F1 005C6098
005C61EC 005C620D 005C6233 005C6257 005C6369 005C638A 005C6486 005C64A7
005C64C9 005C64ED 005C782A 005C7846 005C7862 005C787E 005C7CF8 005C7D14
005C7D30 005C7D4C 005C8B8D 005C8BA9 005C8BC5 005C8BE1 005C9040 005C905C
005C9078 005C9094 005C916E 005C918A 005C91A6 005C91C2 005D0A26 005D0BAB
005D0E4C 005D0E98 005D0FF4 005D10DA 005D111A 005D114D 005D11EA 005D1228
005D126C 005D1288 005D13C5 005D1E9E 005D1EBA 005D1ED6 005D1EF2 005D1FBB
005D1FD7 005D1FF3 005D200F 005D3307 005D3323 005D333F 005D335B 005D5D96
005D5DB2 005D5DCE 005D5DEA 005D6310 005D632C 005D6348 005D6364 005D884E
005D886F 005D8890 005D88B4 005D89BE 005D89DF 005D8ADD 005D8AFE 005D9B8E
005D9BB2 005D9BD6 005D9BFD 005D9D07 005D9D2B 005D9F3E 005D9F62 005DA8E7
005DA903 005DA91F 005DA93B 005DAD30 005DAD4C 005DAD68 005DAD84 005DBCF9
005DBD1A 005DBD3B 005DBD5F 005DC1D8 005DC200 005DF5F4 005DF610 005DF62C
005DF648 005E0FA7 005E0FC3 005E0FDF 005E0FFB 005E2224 005E2245 005E2266
005E228A 005E266A 005E268B 005E2766 005E2787 005E27A8 005E27CC 005E28B6
005E28D7 005E29CC 005E29ED 005E2AEC 005E2B0D 005E2C02 005E2C23 005E32CE
005E32F2 005E3316 005E333D 005E3427 005E344B 005E346F 005E3496 005E357D
005E35A1 005E3694 005E36B8 005E36DC 005E3703 005E42CE 005E42EF 005E4310
005E4334 005E4436 005E4457 005E4BA3 005E4BC4 005E4BE5 005E4C09 005E543B
005E545C 005E547D 005E54A1 005E55A7 005E55C8 005E5966 005E5987 005E59A8
005E59CC 005E5ACE 005E5AEF 005EA0E2 005EA103 005EA124 005EA148 005EA38F
005EA3B7 005EC585 005EC5A6 005EC5C7 005EC5EB 005EC6F0 005EC711 005ECB1F
005ECB40 005ECB61 005ECB85 005ECC8A 005ECCAB 005ED0F9 005ED11D 005ED141
005ED168 005ED27F 005ED2A3 005EE0CF 005EE0F0 005EE111 005EE135 005F00CB
005F00EF 005F0113 005F0194 005F01BC 005F01E7 005F03B2 005F0511 005F0538
005F05A8 005F06CE 005F0769 005F0952 005F0970 005F09C9 005F0C1B 005F0C53
005F0C7B 005F0CA6 005F19D8 005F19F9 005F1A1A 005F1A3E 005F293C 005F295D
005F297E 005F29A2 005F3CF2 005F3D13 005F3D34 005F3D58 005F3E5D 005F3E7E
005F4298 005F42B9 005F42DA 005F42FE 005F477B 005F479C 005F487A 005F489B
005F48BC 005F48E0 005F49BB 005F49DC 005F4BB0 005F4BD1 005F4BF2 005F4C16
005F4D0D 005F4D2E 005F4F24 005F4F45 005F4F66 005F4F8A 005F5065 005F5086
005F530B 005F537B 005F70A7 005F70C8 005F70E9 005F710D 005F9B67 005F9B8B
005F9BAF 005F9BD6 005F9CB9 005F9CDD 005F9D00 005F9D27 005F9F9B 005F9FBF
005F9FE3 005FA00A 005FB038 005FB060 005FB469 005FCEA8 005FD5AE 005FD63D
005FD9BB 005FDA2A 006049E4 00604A5F 00604AA2 00604C40 00604C68 00607569
00607594 00608D08 00612731 00612811 00612892 00612902 006129CD 00612A1E
00612A66 00612CA1 00615C99 00615CF3 006162FB 006163F8 0061666B 0061674D
00616775 00619881 006198A6 006198CE 00619AC6 00619B09 00619BF5 00619C38
00619D24 00619D67 00619E54 00619E97 00619FAD 00619FD5 0061A000 0061A03B
0061A05F 0061A08A 0061A7A1 0061AB02 0061AB2D 0061B59C 0061B5C1 0061C325
0061C346 0061C367 0061C38B 0061F3EF 00626A9F 00626AD2 00626BD7 00626C08
00628617 00628654 00628AAD 00628ACE 00629A3B 00629A69 00629F61 00629F8C
0062DD83 0062DDAE 0062E2C2 0062E2ED 0062E902 0062E92D 0062EE40 0062EE6B
006894D7 006E240E 006E243E 006E246E

]]

function _M:load()
	if exe_type ~= "play" then return end
	for v in addrs:gmatch("%S+") do
		v = tonumber(v, 16) - 0x400000
		g_poke(v, "\x90")
	end
end

function _M:unload()
	if exe_type ~= "play" then return end
	for v in addrs:gmatch("%S+") do
		v = tonumber(v, 16) - 0x400000
		g_poke(v, "\xf0")
	end
end


return _M